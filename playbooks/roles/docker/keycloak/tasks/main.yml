---
# 主任务：创建 Keycloak 服务，启动 Docker Compose 等

- name: 执行 pre-setup 操作
  include_tasks: "pre-setup.yml"

- name: 渲染 create_keystore.sh 脚本
  template:
    src: "templates/create_keystore.sh.j2"
    dest: "/tmp/create_keystore.sh"
    mode: '0755'

- name: 执行 create_keystore.sh 脚本
  script: /tmp/create_keystore.sh

- name: 渲染 Docker Compose 配置文件
  template:
    src: "templates/docker-compose.yml.j2"
    dest: "/tmp/docker-compose.yml"

- name: 启动 Docker Compose 服务
  become: true
  command: docker-compose -f /tmp/docker-compose.yml up -d

- name: 执行 post-setup 操作
  include_tasks: "post-setup.yml"
